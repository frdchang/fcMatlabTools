<html>
<body>
<script src="resources/eml_report_loadable_data.js"></script>
<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,1" id="srcline1">  1</a></span><span class="line"><span class="comment">%======================================================================</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,2" id="srcline2">  2</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,3" id="srcline3">  3</a></span><span class="line"><span class="comment">% LINK_TRAJECTORIES: links particle positions into trajectories</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,4" id="srcline4">  4</a></span><span class="line"><span class="comment">% * modified by fred chang 20170805 </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,5" id="srcline5">  5</a></span><span class="line"><span class="comment">%   - added 3D support</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,6" id="srcline6">  6</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,7" id="srcline7">  7</a></span><span class="line"><span class="comment">% SYNTAX:  peaks = link_trajectories(peaks, L, viz, nfig)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,8" id="srcline8">  8</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,9" id="srcline9">  9</a></span><span class="line"><span class="comment">% INPUTS:  peaks     peaks cell list of particle positions in all</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,10" id="srcline10"> 10</a></span><span class="line"><span class="comment">%                    frames and zero and second order intensity</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,11" id="srcline11"> 11</a></span><span class="line"><span class="comment">%                    moments as produced by detect_particles</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,12" id="srcline12"> 12</a></span><span class="line"><span class="comment">%          L         maximum allowed particle displacement between</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,13" id="srcline13"> 13</a></span><span class="line"><span class="comment">%                    two subsequent frames (cutoff)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,14" id="srcline14"> 14</a></span><span class="line"><span class="comment">%          viz       =1 if intermediate visualization is needed</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,15" id="srcline15"> 15</a></span><span class="line"><span class="comment">%          nfig      figure number for first viz image</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,16" id="srcline16"> 16</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,17" id="srcline17"> 17</a></span><span class="line"><span class="comment">% The particle matching is done such that the sum of squared</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,18" id="srcline18"> 18</a></span><span class="line"><span class="comment">% displacements between two frames in minimized and also the</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,19" id="srcline19"> 19</a></span><span class="line"><span class="comment">% quadratic differences in the zero and second order intensity</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,20" id="srcline20"> 20</a></span><span class="line"><span class="comment">% moments of the particles are minimizes (more precise: between</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,21" id="srcline21"> 21</a></span><span class="line"><span class="comment">% the particle properties peaks{i}(:,3) and peaks{i}(:,4)).</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,22" id="srcline22"> 22</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,23" id="srcline23"> 23</a></span><span class="line"><span class="comment">% After linkage, the same cell list "peaks" is returned but with</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,24" id="srcline24"> 24</a></span><span class="line"><span class="comment">% the fields peaks{i}(:,6) now filled. All other fields are left</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,25" id="srcline25"> 25</a></span><span class="line"><span class="comment">% untouched. peaks{i}(j,6) contains the index of the one</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,26" id="srcline26"> 26</a></span><span class="line"><span class="comment">% particle in frame i+1 corresponding to particle j in frame i.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,27" id="srcline27"> 27</a></span><span class="line"><span class="comment">% If no correspondence was found (i.e. the trajectory terminates)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,28" id="srcline28"> 28</a></span><span class="line"><span class="comment">% -1 is given.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,29" id="srcline29"> 29</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,30" id="srcline30"> 30</a></span><span class="line"><span class="comment">% Ivo Sbalzarini, 12.2.2003</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,31" id="srcline31"> 31</a></span><span class="line"><span class="comment">% Institute of Computational Science, Swiss Federal</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,32" id="srcline32"> 32</a></span><span class="line"><span class="comment">% Institute of Technology (ETH) Zurich.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,33" id="srcline33"> 33</a></span><span class="line"><span class="comment">% E-mail: sbalzarini@inf.ethz.ch</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,34" id="srcline34"> 34</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,35" id="srcline35"> 35</a></span><span class="line"><span class="comment">% Based on the logistic transportation algorithm described in:</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,36" id="srcline36"> 36</a></span><span class="line"><span class="comment">%     http://www.damtp.cam.ac.uk/user/fdl/people/sd/digimage/<span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,37" id="srcline37"> 37</a></span><span class="line"><span class="comment">%        document/track2d/matching.htm#L_2_PARTICLE_MATCHING</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,38" id="srcline38"> 38</a></span><span class="line"><span class="comment">%======================================================================</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,39" id="srcline39"> 39</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,40" id="srcline40"> 40</a></span><span class="line"><span class="comment">%======================================================================</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,41" id="srcline41"> 41</a></span><span class="line"><span class="comment">% STEP 5: Linking locations into trajectories</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,42" id="srcline42"> 42</a></span><span class="line"><span class="comment">%======================================================================</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,43" id="srcline43"> 43</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,44" id="srcline44"> 44</a></span><span class="line"><span class="keyword">function</span> <span class="var type1" id="S2T1U3">peaks</span> = link_trajectories3D(<span class="var type1" id="S2T1U6">peaks</span>, <span class="var type1" id="S3T3U7">L</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,45" id="srcline45"> 45</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,46" id="srcline46"> 46</a></span><span class="line"><span class="mxinfo " id="T3:U4"><span class="var type1" id="S4T3U10">nframe</span> = <span class="mxinfo " id="T3:U6">length(<span class="var type1" id="S2T1U13">peaks</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,47" id="srcline47"> 47</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,48" id="srcline48"> 48</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S6T3U16">iframe</span> = <span class="mxinfo " id="T3:U9">2</span>:<span class="var type1" id="S4T3U19">nframe</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,49" id="srcline49"> 49</a></span><span class="line">    <span class="comment">% initialize all linked lists to -1</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,50" id="srcline50"> 50</a></span><span class="line">    <span class="mxinfo " id="T4:U11"><span class="mxinfo " id="T4:U12"><span class="mxinfo " id="T2:U13"><span class="var type1" id="S2T1U24">peaks</span>{<span class="mxinfo " id="T3:U15"><span class="var type1" id="S6T3U26">iframe</span>-<span class="mxinfo " id="T3:U17">1</span></span>}</span>(<span class="mxinfo " id="T5:U18">:</span>,<span class="mxinfo " id="T3:U19">6</span>)</span> = <span class="mxinfo " id="T3:U20">-<span class="mxinfo " id="T3:U21">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,51" id="srcline51"> 51</a></span><span class="line">    <span class="mxinfo " id="T3:U22"><span class="var type1" id="S7T3U34">m</span> = <span class="mxinfo " id="T3:U24">length(<span class="mxinfo " id="T4:U25"><span class="mxinfo " id="T2:U26"><span class="var type1" id="S2T1U39">peaks</span>{<span class="mxinfo " id="T3:U28"><span class="var type1" id="S6T3U41">iframe</span>-<span class="mxinfo " id="T3:U30">1</span></span>}</span>(<span class="mxinfo " id="T5:U31">:</span>,<span class="mxinfo " id="T3:U32">1</span>)</span>)</span></span>; <span class="comment">% previous frame: p_i, i=1,..,m</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,52" id="srcline52"> 52</a></span><span class="line">    <span class="mxinfo " id="T3:U33"><span class="var type1" id="S8T3U47">n</span> = <span class="mxinfo " id="T3:U35">length(<span class="mxinfo " id="T4:U36"><span class="mxinfo " id="T2:U37"><span class="var type1" id="S2T1U52">peaks</span>{<span class="var type1" id="S6T3U53">iframe</span>}</span>(<span class="mxinfo " id="T5:U40">:</span>,<span class="mxinfo " id="T3:U41">1</span>)</span>)</span></span>;   <span class="comment">% this frame: q_j, j=1,..,n</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,53" id="srcline53"> 53</a></span><span class="line">    <span class="comment">% empty association matrix</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,54" id="srcline54"> 54</a></span><span class="line">    <span class="mxinfo " id="T2:U42"><span class="var type1" id="S9T2U58">A</span> = <span class="mxinfo " id="T2:U44">zeros(<span class="mxinfo " id="T3:U45"><span class="var type1" id="S7T3U62">m</span>+<span class="mxinfo " id="T3:U47">1</span></span>,<span class="mxinfo " id="T3:U48"><span class="var type1" id="S8T3U65">n</span>+<span class="mxinfo " id="T3:U50">1</span></span>)</span></span>;               <span class="comment">% a_{ij}=1 &lt;=&gt; p_i = q_j</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,55" id="srcline55"> 55</a></span><span class="line">    <span class="comment">% dummy particles a_{(m+1)j},</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,56" id="srcline56"> 56</a></span><span class="line">    <span class="comment">% a_{i(n+1)}</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,57" id="srcline57"> 57</a></span><span class="line">    <span class="comment">% delta(i,j): quadratic distance between p_i and q_j</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,58" id="srcline58"> 58</a></span><span class="line">    <span class="mxinfo " id="T2:U51"><span class="var type1" id="S11T2U69">xrep</span> = <span class="mxinfo " id="T2:U53">repmat(<span class="mxinfo " id="T6:U54"><span class="mxinfo " id="T4:U55"><span class="mxinfo " id="T2:U56"><span class="var type1" id="S2T1U75">peaks</span>{<span class="var type1" id="S6T3U76">iframe</span>}</span>(<span class="mxinfo " id="T5:U59">:</span>,<span class="mxinfo " id="T3:U60">1</span>)</span>'</span>,<span class="var type1" id="S7T3U79">m</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,59" id="srcline59"> 59</a></span><span class="line">    <span class="mxinfo " id="T2:U62"><span class="var type1" id="S13T2U83">yrep</span> = <span class="mxinfo " id="T2:U64">repmat(<span class="mxinfo " id="T6:U65"><span class="mxinfo " id="T4:U66"><span class="mxinfo " id="T2:U67"><span class="var type1" id="S2T1U89">peaks</span>{<span class="var type1" id="S6T3U90">iframe</span>}</span>(<span class="mxinfo " id="T5:U70">:</span>,<span class="mxinfo " id="T3:U71">2</span>)</span>'</span>,<span class="var type1" id="S7T3U93">m</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,60" id="srcline60"> 60</a></span><span class="line">    <span class="mxinfo " id="T2:U73"><span class="var type1" id="S14T2U97">zrep</span> = <span class="mxinfo " id="T2:U75">repmat(<span class="mxinfo " id="T6:U76"><span class="mxinfo " id="T4:U77"><span class="mxinfo " id="T2:U78"><span class="var type1" id="S2T1U103">peaks</span>{<span class="var type1" id="S6T3U104">iframe</span>}</span>(<span class="mxinfo " id="T5:U81">:</span>,<span class="mxinfo " id="T3:U82">3</span>)</span>'</span>,<span class="var type1" id="S7T3U107">m</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,61" id="srcline61"> 61</a></span><span class="line">    <span class="mxinfo " id="T2:U84"><span class="var type1" id="S15T2U111">xdiff</span> = <span class="mxinfo " id="T2:U86"><span class="var type1" id="S11T2U113">xrep</span> - <span class="mxinfo " id="T2:U88">repmat(<span class="mxinfo " id="T4:U89"><span class="mxinfo " id="T2:U90"><span class="var type1" id="S2T1U118">peaks</span>{<span class="mxinfo " id="T3:U92"><span class="var type1" id="S6T3U120">iframe</span>-<span class="mxinfo " id="T3:U94">1</span></span>}</span>(<span class="mxinfo " id="T5:U95">:</span>,<span class="mxinfo " id="T3:U96">1</span>)</span>,1,<span class="var type1" id="S8T3U125">n</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,62" id="srcline62"> 62</a></span><span class="line">    <span class="mxinfo " id="T2:U98"><span class="var type1" id="S16T2U128">ydiff</span> = <span class="mxinfo " id="T2:U100"><span class="var type1" id="S13T2U130">yrep</span> - <span class="mxinfo " id="T2:U102">repmat(<span class="mxinfo " id="T4:U103"><span class="mxinfo " id="T2:U104"><span class="var type1" id="S2T1U135">peaks</span>{<span class="mxinfo " id="T3:U106"><span class="var type1" id="S6T3U137">iframe</span>-<span class="mxinfo " id="T3:U108">1</span></span>}</span>(<span class="mxinfo " id="T5:U109">:</span>,<span class="mxinfo " id="T3:U110">2</span>)</span>,1,<span class="var type1" id="S8T3U142">n</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,63" id="srcline63"> 63</a></span><span class="line">    <span class="mxinfo " id="T2:U112"><span class="var type1" id="S17T2U145">zdiff</span> = <span class="mxinfo " id="T2:U114"><span class="var type1" id="S14T2U147">zrep</span> - <span class="mxinfo " id="T2:U116">repmat(<span class="mxinfo " id="T4:U117"><span class="mxinfo " id="T2:U118"><span class="var type1" id="S2T1U152">peaks</span>{<span class="mxinfo " id="T3:U120"><span class="var type1" id="S6T3U154">iframe</span>-<span class="mxinfo " id="T3:U122">1</span></span>}</span>(<span class="mxinfo " id="T5:U123">:</span>,<span class="mxinfo " id="T3:U124">3</span>)</span>,1,<span class="var type1" id="S8T3U159">n</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,64" id="srcline64"> 64</a></span><span class="line">    <span class="mxinfo " id="T2:U126"><span class="var type1" id="S18T2U162">delta</span> = <span class="mxinfo " id="T2:U128"><span class="mxinfo " id="T2:U129">(<span class="mxinfo " id="T2:U130"><span class="var type1" id="S15T2U167">xdiff</span>.^2</span>)+(<span class="mxinfo " id="T2:U132"><span class="var type1" id="S16T2U171">ydiff</span>.^2</span>)</span>+(<span class="mxinfo " id="T2:U134"><span class="var type1" id="S17T2U175">zdiff</span>.^2</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,65" id="srcline65"> 65</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,66" id="srcline66"> 66</a></span><span class="line">    <span class="comment">% dm0(i,j): quadratic difference between m0 moments of p_i and q_j</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,67" id="srcline67"> 67</a></span><span class="line">    <span class="mxinfo " id="T2:U136"><span class="var type1" id="S11T2U179">xrep</span> = <span class="mxinfo " id="T2:U138">repmat(<span class="mxinfo " id="T6:U139"><span class="mxinfo " id="T4:U140"><span class="mxinfo " id="T2:U141"><span class="var type1" id="S2T1U185">peaks</span>{<span class="var type1" id="S6T3U186">iframe</span>}</span>(<span class="mxinfo " id="T5:U144">:</span>,<span class="mxinfo " id="T3:U145">4</span>)</span>'</span>,<span class="var type1" id="S7T3U189">m</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,68" id="srcline68"> 68</a></span><span class="line">    <span class="mxinfo " id="T2:U147"><span class="var type1" id="S15T2U193">xdiff</span> = <span class="mxinfo " id="T2:U149"><span class="var type1" id="S11T2U195">xrep</span> - <span class="mxinfo " id="T2:U151">repmat(<span class="mxinfo " id="T4:U152"><span class="mxinfo " id="T2:U153"><span class="var type1" id="S2T1U200">peaks</span>{<span class="mxinfo " id="T3:U155"><span class="var type1" id="S6T3U202">iframe</span>-<span class="mxinfo " id="T3:U157">1</span></span>}</span>(<span class="mxinfo " id="T5:U158">:</span>,<span class="mxinfo " id="T3:U159">4</span>)</span>,1,<span class="var type1" id="S8T3U207">n</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,69" id="srcline69"> 69</a></span><span class="line">    <span class="mxinfo " id="T2:U161"><span class="var type1" id="S19T2U210">dm0</span> = <span class="mxinfo " id="T2:U163"><span class="var type1" id="S15T2U212">xdiff</span>.^2</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,70" id="srcline70"> 70</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,71" id="srcline71"> 71</a></span><span class="line">    <span class="comment">% dm2(i,j): quadratic difference between m2 moments of p_i and q_j</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,72" id="srcline72"> 72</a></span><span class="line">    <span class="mxinfo " id="T2:U165"><span class="var type1" id="S11T2U216">xrep</span> = <span class="mxinfo " id="T2:U167">repmat(<span class="mxinfo " id="T6:U168"><span class="mxinfo " id="T4:U169"><span class="mxinfo " id="T2:U170"><span class="var type1" id="S2T1U222">peaks</span>{<span class="var type1" id="S6T3U223">iframe</span>}</span>(<span class="mxinfo " id="T5:U173">:</span>,<span class="mxinfo " id="T3:U174">5</span>)</span>'</span>,<span class="var type1" id="S7T3U226">m</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,73" id="srcline73"> 73</a></span><span class="line">    <span class="mxinfo " id="T2:U176"><span class="var type1" id="S15T2U230">xdiff</span> = <span class="mxinfo " id="T2:U178"><span class="var type1" id="S11T2U232">xrep</span> - <span class="mxinfo " id="T2:U180">repmat(<span class="mxinfo " id="T4:U181"><span class="mxinfo " id="T2:U182"><span class="var type1" id="S2T1U237">peaks</span>{<span class="mxinfo " id="T3:U184"><span class="var type1" id="S6T3U239">iframe</span>-<span class="mxinfo " id="T3:U186">1</span></span>}</span>(<span class="mxinfo " id="T5:U187">:</span>,<span class="mxinfo " id="T3:U188">5</span>)</span>,1,<span class="var type1" id="S8T3U244">n</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,74" id="srcline74"> 74</a></span><span class="line">    <span class="mxinfo " id="T2:U190"><span class="var type1" id="S20T2U247">dm2</span> = <span class="mxinfo " id="T2:U192"><span class="var type1" id="S15T2U249">xdiff</span>.^2</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,75" id="srcline75"> 75</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,76" id="srcline76"> 76</a></span><span class="line">    <span class="comment">% C(i,j): cost function for link p_i, q_j</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,77" id="srcline77"> 77</a></span><span class="line">    <span class="mxinfo " id="T2:U194"><span class="var type1" id="S21T2U253">C</span> = <span class="mxinfo " id="T2:U196"><span class="mxinfo " id="T3:U197"><span class="var type1" id="S3T3U256">L</span>*<span class="var type1" id="S3T3U257">L</span></span>*<span class="mxinfo " id="T2:U200">ones(<span class="mxinfo " id="T3:U201"><span class="var type1" id="S7T3U261">m</span>+<span class="mxinfo " id="T3:U203">1</span></span>,<span class="mxinfo " id="T3:U204"><span class="var type1" id="S8T3U264">n</span>+<span class="mxinfo " id="T3:U206">1</span></span>)</span></span></span>;   <span class="comment">% set broken dummy links to L^2</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,78" id="srcline78"> 78</a></span><span class="line">    <span class="mxinfo " id="T2:U207"><span class="mxinfo " id="T2:U208"><span class="var type1" id="S21T2U269">C</span>(<span class="mxinfo " id="T6:U210"><span class="mxinfo " id="T3:U211">1</span>:<span class="var type1" id="S7T3U272">m</span></span>,<span class="mxinfo " id="T6:U213"><span class="mxinfo " id="T3:U214">1</span>:<span class="var type1" id="S8T3U275">n</span></span>)</span> = (<span class="mxinfo " id="T2:U216"><span class="mxinfo " id="T2:U217"><span class="var type1" id="S18T2U279">delta</span>+<span class="var type1" id="S19T2U280">dm0</span></span>+<span class="var type1" id="S20T2U281">dm2</span></span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,79" id="srcline79"> 79</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,80" id="srcline80"> 80</a></span><span class="line">    <span class="comment">% set cost of matchings that will never occur to Inf</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,81" id="srcline81"> 81</a></span><span class="line">    <span class="mxinfo " id="T2:U221"><span class="var type1" id="S23T2U284">C1</span> = <span class="mxinfo " id="T2:U223"><span class="mxinfo " id="T2:U224"><span class="var type1" id="S21T2U287">C</span>(<span class="mxinfo " id="T6:U226"><span class="mxinfo " id="T3:U227">1</span>:<span class="var type1" id="S7T3U290">m</span></span>,<span class="mxinfo " id="T6:U229"><span class="mxinfo " id="T3:U230">1</span>:<span class="var type1" id="S8T3U293">n</span></span>)</span> - <span class="mxinfo " id="T2:U232">repmat(<span class="mxinfo " id="T6:U233"><span class="var type1" id="S21T2U297">C</span>(<span class="mxinfo " id="T3:U235"><span class="var type1" id="S7T3U299">m</span>+<span class="mxinfo " id="T3:U237">1</span></span>,<span class="mxinfo " id="T6:U238"><span class="mxinfo " id="T3:U239">1</span>:<span class="var type1" id="S8T3U303">n</span></span>)</span>,<span class="var type1" id="S7T3U304">m</span>,1)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,82" id="srcline82"> 82</a></span><span class="line">    <span class="mxinfo " id="T2:U242"><span class="var type1" id="S24T2U308">C2</span> = <span class="mxinfo " id="T2:U244"><span class="mxinfo " id="T2:U245"><span class="var type1" id="S21T2U311">C</span>(<span class="mxinfo " id="T6:U247"><span class="mxinfo " id="T3:U248">1</span>:<span class="var type1" id="S7T3U314">m</span></span>,<span class="mxinfo " id="T6:U250"><span class="mxinfo " id="T3:U251">1</span>:<span class="var type1" id="S8T3U317">n</span></span>)</span> - <span class="mxinfo " id="T2:U253">repmat(<span class="mxinfo " id="T4:U254"><span class="var type1" id="S21T2U321">C</span>(<span class="mxinfo " id="T6:U256"><span class="mxinfo " id="T3:U257">1</span>:<span class="var type1" id="S7T3U324">m</span></span>,<span class="mxinfo " id="T3:U259"><span class="var type1" id="S8T3U326">n</span>+<span class="mxinfo " id="T3:U261">1</span></span>)</span>,1,<span class="var type1" id="S8T3U329">n</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,83" id="srcline83"> 83</a></span><span class="line">    <span class="mxinfo " id="T4:U263"><span class="var type1" id="S25T4U332">set1</span> = <span class="mxinfo " id="T4:U265">find(<span class="mxinfo " id="T7:U266"><span class="var type1" id="S23T2U336">C1</span> &gt; <span class="mxinfo " id="T3:U268">0</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,84" id="srcline84"> 84</a></span><span class="line">    <span class="mxinfo " id="T4:U269"><span class="var type1" id="S27T4U340">set2</span> = <span class="mxinfo " id="T4:U271">find(<span class="mxinfo " id="T7:U272"><span class="var type1" id="S24T2U344">C2</span> &gt; <span class="mxinfo " id="T3:U274">0</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,85" id="srcline85"> 85</a></span><span class="line">    <span class="mxinfo " id="T4:U275"><span class="var type1" id="S28T4U348">s</span> = <span class="mxinfo " id="T4:U277">union(<span class="var type1" id="S25T4U351">set1</span>,<span class="var type1" id="S27T4U352">set2</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,86" id="srcline86"> 86</a></span><span class="line">    [<span class="var type1" id="S30T4U356">i</span>,<span class="var type1" id="S31T4U357">j</span>] = ind2sub(<span class="mxinfo " id="T8:U282">[<span class="var type1" id="S7T3U362">m</span> <span class="var type1" id="S8T3U363">n</span>]</span>,<span class="var type1" id="S28T4U364">s</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,87" id="srcline87"> 87</a></span><span class="line">    <span class="mxinfo " id="T4:U286"><span class="mxinfo " id="T4:U287"><span class="var type1" id="S21T2U368">C</span>(<span class="mxinfo " id="T4:U289">sub2ind(<span class="mxinfo " id="T8:U290">size(<span class="var type1" id="S21T2U373">C</span>)</span>,<span class="var type1" id="S30T4U374">i</span>,<span class="var type1" id="S31T4U375">j</span>)</span>)</span> = <span class="mxinfo " id="T3:U294">Inf</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,88" id="srcline88"> 88</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,89" id="srcline89"> 89</a></span><span class="line">    <span class="comment">% initialize link matrix A</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,90" id="srcline90"> 90</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S30T3U380">i</span>=<span class="mxinfo " id="T3:U296">1</span>:<span class="var type1" id="S7T3U383">m</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,91" id="srcline91"> 91</a></span><span class="line">        <span class="comment">% sort costs of real particles</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,92" id="srcline92"> 92</a></span><span class="line">        [<span class="mxinfo " id="T6:U298">~</span>,<span class="var type1" id="S36T6U388">srtidx</span>] = sort(<span class="mxinfo " id="T6:U300"><span class="var type1" id="S21T2U392">C</span>(<span class="var type1" id="S30T3U393">i</span>,<span class="mxinfo " id="T5:U303">:</span>)</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,93" id="srcline93"> 93</a></span><span class="line">        <span class="comment">% append index of dummy particle</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,94" id="srcline94"> 94</a></span><span class="line">        <span class="mxinfo " id="T3:U304"><span class="var type1" id="S38T3U397">iidx</span> = <span class="mxinfo " id="T3:U306">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,95" id="srcline95"> 95</a></span><span class="line">        <span class="mxinfo " id="T6:U307"><span class="var type1" id="S39T6U401">dumidx</span> = <span class="mxinfo " id="T6:U309">find(<span class="mxinfo " id="T9:U310"><span class="var type1" id="S36T6U405">srtidx</span>==(<span class="mxinfo " id="T3:U312"><span class="var type1" id="S8T3U408">n</span>+<span class="mxinfo " id="T3:U314">1</span></span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,96" id="srcline96"> 96</a></span><span class="line">        <span class="comment">% search for available particle of smallest cost or dummy</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,97" id="srcline97"> 97</a></span><span class="line">        <span class="mxinfo " id="T10:U315"><span class="keyword">while</span> <span class="mxinfo " id="T9:U316">and(<span class="mxinfo " id="T10:U317"><span class="mxinfo " id="T3:U318">sum(<span class="mxinfo " id="T4:U319"><span class="var type1" id="S9T2U417">A</span>(<span class="mxinfo " id="T5:U321">:</span>,<span class="mxinfo " id="T3:U322"><span class="var type1" id="S36T6U420">srtidx</span>(<span class="var type1" id="S38T3U421">iidx</span>)</span>)</span>)</span>~=<span class="mxinfo " id="T3:U325">0</span></span>, <span class="mxinfo " id="T9:U326"><span class="var type1" id="S38T3U424">iidx</span>&lt;<span class="var type1" id="S39T6U425">dumidx</span></span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,98" id="srcline98"> 98</a></span><span class="line">            <span class="mxinfo " id="T3:U329"><span class="var type1" id="S38T3U428">iidx</span> = <span class="mxinfo " id="T3:U331"><span class="var type1" id="S38T3U430">iidx</span> + <span class="mxinfo " id="T3:U333">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,99" id="srcline99"> 99</a></span><span class="line">        <span class="keyword">end</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,100" id="srcline100">100</a></span><span class="line">        <span class="mxinfo " id="T3:U334"><span class="mxinfo " id="T3:U335"><span class="var type1" id="S9T2U435">A</span>(<span class="var type1" id="S30T3U436">i</span>,<span class="mxinfo " id="T3:U338"><span class="var type1" id="S36T6U438">srtidx</span>(<span class="var type1" id="S38T3U439">iidx</span>)</span>)</span> = <span class="mxinfo " id="T3:U341">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,101" id="srcline101">101</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,102" id="srcline102">102</a></span><span class="line">    <span class="comment">% set dummy particle for columns with no entry</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,103" id="srcline103">103</a></span><span class="line">    <span class="mxinfo " id="T6:U342"><span class="var type1" id="S28T6U443">s</span> = <span class="mxinfo " id="T6:U344">sum(<span class="var type1" id="S9T2U446">A</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,104" id="srcline104">104</a></span><span class="line">    <span class="mxinfo " id="T6:U346"><span class="mxinfo " id="T6:U347"><span class="var type1" id="S9T2U451">A</span>(<span class="mxinfo " id="T3:U349"><span class="var type1" id="S7T3U453">m</span>+<span class="mxinfo " id="T3:U351">1</span></span>,(<span class="mxinfo " id="T9:U352"><span class="var type1" id="S28T6U457">s</span> &lt; <span class="mxinfo " id="T3:U354">1</span></span>))</span> = <span class="mxinfo " id="T3:U355">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,105" id="srcline105">105</a></span><span class="line">    <span class="comment">% dummy always corresponds to dummy</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,106" id="srcline106">106</a></span><span class="line">    <span class="mxinfo " id="T3:U356"><span class="mxinfo " id="T3:U357"><span class="var type1" id="S9T2U463">A</span>(<span class="mxinfo " id="T3:U359"><span class="var type1" id="S7T3U465">m</span>+<span class="mxinfo " id="T3:U361">1</span></span>,<span class="mxinfo " id="T3:U362"><span class="var type1" id="S8T3U468">n</span>+<span class="mxinfo " id="T3:U364">1</span></span>)</span> = <span class="mxinfo " id="T3:U365">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,107" id="srcline107">107</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,108" id="srcline108">108</a></span><span class="line">    <span class="comment">% consistency check for matrix A</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,109" id="srcline109">109</a></span><span class="line">    <span class="mxinfo " id="T6:U366"><span class="var type1" id="S28T6U473">s</span> = <span class="mxinfo " id="T6:U368">sum(<span class="mxinfo " id="T2:U369"><span class="var type1" id="S9T2U477">A</span>(<span class="mxinfo " id="T5:U371">:</span>,<span class="mxinfo " id="T6:U372"><span class="mxinfo " id="T3:U373">1</span>:<span class="var type1" id="S8T3U481">n</span></span>)</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,110" id="srcline110">110</a></span><span class="line">    <span class="mxinfo " id="T10:U375"><span class="keyword">if</span> <span class="mxinfo " id="T6:U376">find(<span class="mxinfo " id="T9:U377"><span class="mxinfo " id="T6:U378"><span class="var type1" id="S28T6U489">s</span>(<span class="mxinfo " id="T6:U380"><span class="mxinfo " id="T3:U381">1</span>:<span class="var type1" id="S8T3U492">n</span></span>)</span>~=<span class="mxinfo " id="T3:U383">1</span></span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,111" id="srcline111">111</a></span><span class="line">        <span class="mxinfo " id="T11:U384"><span class="autoExtrinsicFcn" id="F381N3:B496">disp</span>(<span class="mxinfo " id="T12:U385"><span class="string">'Inconsistent initial matrix A. Columns: '</span></span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,112" id="srcline112">112</a></span><span class="line">        find(<span class="mxinfo " id="T9:U386"><span class="mxinfo " id="T6:U387"><span class="var type1" id="S28T6U503">s</span>(<span class="mxinfo " id="T6:U389"><span class="mxinfo " id="T3:U390">1</span>:<span class="var type1" id="S8T3U506">n</span></span>)</span>~=<span class="mxinfo " id="T3:U392">1</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,113" id="srcline113">113</a></span><span class="line">    <span class="keyword">end</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,114" id="srcline114">114</a></span><span class="line">    <span class="mxinfo " id="T4:U393"><span class="var type1" id="S28T4U510">s</span> = <span class="mxinfo " id="T4:U395">sum(<span class="mxinfo " id="T2:U396"><span class="var type1" id="S9T2U514">A</span>(<span class="mxinfo " id="T6:U398"><span class="mxinfo " id="T3:U399">1</span>:<span class="var type1" id="S7T3U517">m</span></span>,<span class="mxinfo " id="T5:U401">:</span>)</span>,2)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,115" id="srcline115">115</a></span><span class="line">    <span class="mxinfo " id="T10:U402"><span class="keyword">if</span> <span class="mxinfo " id="T4:U403">find(<span class="mxinfo " id="T13:U404"><span class="mxinfo " id="T4:U405"><span class="var type1" id="S28T4U526">s</span>(<span class="mxinfo " id="T6:U407"><span class="mxinfo " id="T3:U408">1</span>:<span class="var type1" id="S7T3U529">m</span></span>)</span>~=<span class="mxinfo " id="T3:U410">1</span></span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,116" id="srcline116">116</a></span><span class="line">        <span class="mxinfo " id="T11:U411"><span class="autoExtrinsicFcn" id="F382N3:B533">disp</span>(<span class="mxinfo " id="T14:U412"><span class="string">'Inconsistent initial matrix A. Rows:'</span></span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,117" id="srcline117">117</a></span><span class="line">        find(<span class="mxinfo " id="T13:U413"><span class="mxinfo " id="T4:U414"><span class="var type1" id="S28T4U540">s</span>(<span class="mxinfo " id="T6:U416"><span class="mxinfo " id="T3:U417">1</span>:<span class="var type1" id="S7T3U543">m</span></span>)</span>~=<span class="mxinfo " id="T3:U419">1</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,118" id="srcline118">118</a></span><span class="line">    <span class="keyword">end</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,119" id="srcline119">119</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,120" id="srcline120">120</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,121" id="srcline121">121</a></span><span class="line">    <span class="comment">% iteration loop for the logistic transportation algorithm</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,122" id="srcline122">122</a></span><span class="line">    <span class="mxinfo " id="T3:U420"><span class="var type1" id="S43T3U547">finished</span> = <span class="mxinfo " id="T3:U422">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,123" id="srcline123">123</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,124" id="srcline124">124</a></span><span class="line">    <span class="keyword">while</span> <span class="mxinfo " id="T10:U423">~<span class="var type1" id="S43T3U551">finished</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,125" id="srcline125">125</a></span><span class="line">        <span class="comment">% non-set links of finite cost</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,126" id="srcline126">126</a></span><span class="line">        <span class="mxinfo " id="T4:U425"><span class="var type1" id="S44T4U554">todo</span> = <span class="mxinfo " id="T4:U427">intersect(<span class="mxinfo " id="T4:U428">find(<span class="mxinfo " id="T7:U429"><span class="mxinfo " id="T2:U430"><span class="var type1" id="S9T2U561">A</span>(<span class="mxinfo " id="T6:U432"><span class="mxinfo " id="T3:U433">1</span>:<span class="var type1" id="S7T3U564">m</span></span>,<span class="mxinfo " id="T6:U435"><span class="mxinfo " id="T3:U436">1</span>:<span class="var type1" id="S8T3U567">n</span></span>)</span>==<span class="mxinfo " id="T3:U438">0</span></span>)</span>,<span class="mxinfo " id="T4:U439">find(<span class="mxinfo " id="T7:U440"><span class="mxinfo " id="T2:U441"><span class="var type1" id="S21T2U573">C</span>(<span class="mxinfo " id="T6:U443"><span class="mxinfo " id="T3:U444">1</span>:<span class="var type1" id="S7T3U576">m</span></span>,<span class="mxinfo " id="T6:U446"><span class="mxinfo " id="T3:U447">1</span>:<span class="var type1" id="S8T3U579">n</span></span>)</span>&lt;<span class="mxinfo " id="T3:U449">Inf</span></span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,127" id="srcline127">127</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,128" id="srcline128">128</a></span><span class="line">        <span class="comment">% determine induced changes and reduced cost Cred for each</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,129" id="srcline129">129</a></span><span class="line">        <span class="comment">% candidate link insertion</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,130" id="srcline130">130</a></span><span class="line">        [<span class="var type1" id="S46T4U585">Icand</span>,<span class="var type1" id="S47T4U586">Jcand</span>] = ind2sub(<span class="mxinfo " id="T8:U452">[<span class="var type1" id="S7T3U591">m</span> <span class="var type1" id="S8T3U592">n</span>]</span>,<span class="var type1" id="S44T4U593">todo</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,131" id="srcline131">131</a></span><span class="line">        <span class="mxinfo " id="T4:U456"><span class="var type1" id="S48T4U596">Cred</span> = <span class="mxinfo " id="T4:U458">zeros(<span class="mxinfo " id="T3:U459">size(<span class="var type1" id="S46T4U601">Icand</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,132" id="srcline132">132</a></span><span class="line">        <span class="mxinfo " id="T4:U461"><span class="var type1" id="S49T4U604">Xcand</span> = <span class="mxinfo " id="T4:U463">zeros(<span class="mxinfo " id="T3:U464">size(<span class="var type1" id="S46T4U609">Icand</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,133" id="srcline133">133</a></span><span class="line">        <span class="mxinfo " id="T4:U466"><span class="var type1" id="S50T4U612">Ycand</span> = <span class="mxinfo " id="T4:U468">zeros(<span class="mxinfo " id="T3:U469">size(<span class="var type1" id="S46T4U617">Icand</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,134" id="srcline134">134</a></span><span class="line">        <span class="keyword">for</span> <span class="var type1" id="S51T3U620">ic</span>=<span class="mxinfo " id="T3:U472">1</span>:<span class="mxinfo " id="T3:U473">length(<span class="var type1" id="S46T4U625">Icand</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,135" id="srcline135">135</a></span><span class="line">            <span class="mxinfo " id="T3:U475"><span class="mxinfo " id="T3:U476"><span class="var type1" id="S48T4U629">Cred</span>(<span class="var type1" id="S51T3U630">ic</span>)</span> = <span class="mxinfo " id="T3:U479"><span class="var type1" id="S21T2U632">C</span>(<span class="mxinfo " id="T3:U481"><span class="var type1" id="S46T4U634">Icand</span>(<span class="var type1" id="S51T3U635">ic</span>)</span>,<span class="mxinfo " id="T3:U484"><span class="var type1" id="S47T4U637">Jcand</span>(<span class="var type1" id="S51T3U638">ic</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,136" id="srcline136">136</a></span><span class="line">            <span class="mxinfo " id="T3:U487"><span class="mxinfo " id="T3:U488"><span class="var type1" id="S49T4U642">Xcand</span>(<span class="var type1" id="S51T3U643">ic</span>)</span> = <span class="mxinfo " id="T6:U491">find(<span class="mxinfo " id="T9:U492"><span class="mxinfo " id="T6:U493"><span class="var type1" id="S9T2U648">A</span>(<span class="mxinfo " id="T3:U495"><span class="var type1" id="S46T4U650">Icand</span>(<span class="var type1" id="S51T3U651">ic</span>)</span>,<span class="mxinfo " id="T5:U498">:</span>)</span>==<span class="mxinfo " id="T3:U499">1</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,137" id="srcline137">137</a></span><span class="line">            <span class="mxinfo " id="T3:U500"><span class="mxinfo " id="T3:U501"><span class="var type1" id="S50T4U657">Ycand</span>(<span class="var type1" id="S51T3U658">ic</span>)</span> = <span class="mxinfo " id="T4:U504">find(<span class="mxinfo " id="T13:U505"><span class="mxinfo " id="T4:U506"><span class="var type1" id="S9T2U663">A</span>(<span class="mxinfo " id="T5:U508">:</span>,<span class="mxinfo " id="T3:U509"><span class="var type1" id="S47T4U666">Jcand</span>(<span class="var type1" id="S51T3U667">ic</span>)</span>)</span>==<span class="mxinfo " id="T3:U512">1</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,138" id="srcline138">138</a></span><span class="line">            <span class="mxinfo " id="T3:U513"><span class="mxinfo " id="T3:U514"><span class="var type1" id="S48T4U672">Cred</span>(<span class="var type1" id="S51T3U673">ic</span>)</span> = <span class="mxinfo " id="T3:U517"><span class="mxinfo " id="T3:U518"><span class="mxinfo " id="T3:U519"><span class="var type1" id="S48T4U677">Cred</span>(<span class="var type1" id="S51T3U678">ic</span>)</span>-<span class="mxinfo " id="T3:U522"><span class="var type1" id="S21T2U680">C</span>(<span class="mxinfo " id="T3:U524"><span class="var type1" id="S46T4U682">Icand</span>(<span class="var type1" id="S51T3U683">ic</span>)</span>,<span class="mxinfo " id="T3:U527"><span class="var type1" id="S49T4U685">Xcand</span>(<span class="var type1" id="S51T3U686">ic</span>)</span>)</span></span>-<span class="mxinfo " id="T3:U530"><span class="var type1" id="S21T2U688">C</span>(<span class="mxinfo " id="T3:U532"><span class="var type1" id="S50T4U690">Ycand</span>(<span class="var type1" id="S51T3U691">ic</span>)</span>,<span class="mxinfo " id="T3:U535"><span class="var type1" id="S47T4U693">Jcand</span>(<span class="var type1" id="S51T3U694">ic</span>)</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,139" id="srcline139">139</a></span><span class="line">            <span class="mxinfo " id="T3:U538"><span class="mxinfo " id="T3:U539"><span class="var type1" id="S48T4U698">Cred</span>(<span class="var type1" id="S51T3U699">ic</span>)</span> = <span class="mxinfo " id="T3:U542"><span class="mxinfo " id="T3:U543"><span class="var type1" id="S48T4U702">Cred</span>(<span class="var type1" id="S51T3U703">ic</span>)</span>+<span class="mxinfo " id="T3:U546"><span class="var type1" id="S21T2U705">C</span>(<span class="mxinfo " id="T3:U548"><span class="var type1" id="S50T4U707">Ycand</span>(<span class="var type1" id="S51T3U708">ic</span>)</span>,<span class="mxinfo " id="T3:U551"><span class="var type1" id="S49T4U710">Xcand</span>(<span class="var type1" id="S51T3U711">ic</span>)</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,140" id="srcline140">140</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,141" id="srcline141">141</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,142" id="srcline142">142</a></span><span class="line">        <span class="comment">% find minimum cost and corresponding action</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,143" id="srcline143">143</a></span><span class="line">        [<span class="var type1" id="S52T3U715">minc</span>,<span class="var type1" id="S53T3U716">mini</span>] = min(<span class="var type1" id="S48T4U719">Cred</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,144" id="srcline144">144</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,145" id="srcline145">145</a></span><span class="line">        <span class="comment">% if minimum is &lt; 0, link addition is favorable</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,146" id="srcline146">146</a></span><span class="line">        <span class="keyword">if</span> <span class="mxinfo " id="T10:U557"><span class="var type1" id="S52T3U723">minc</span> &lt; <span class="mxinfo " id="T3:U559">0</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,147" id="srcline147">147</a></span><span class="line">            <span class="comment">% add link and update dependencies to preserve topology</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,148" id="srcline148">148</a></span><span class="line">            <span class="mxinfo " id="T3:U560"><span class="mxinfo " id="T3:U561"><span class="var type1" id="S9T2U728">A</span>(<span class="mxinfo " id="T3:U563"><span class="var type1" id="S46T4U730">Icand</span>(<span class="var type1" id="S53T3U731">mini</span>)</span>,<span class="mxinfo " id="T3:U566"><span class="var type1" id="S47T4U733">Jcand</span>(<span class="var type1" id="S53T3U734">mini</span>)</span>)</span> = <span class="mxinfo " id="T3:U569">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,149" id="srcline149">149</a></span><span class="line">            <span class="mxinfo " id="T3:U570"><span class="mxinfo " id="T3:U571"><span class="var type1" id="S9T2U739">A</span>(<span class="mxinfo " id="T3:U573"><span class="var type1" id="S50T4U741">Ycand</span>(<span class="var type1" id="S53T3U742">mini</span>)</span>,<span class="mxinfo " id="T3:U576"><span class="var type1" id="S47T4U744">Jcand</span>(<span class="var type1" id="S53T3U745">mini</span>)</span>)</span> = <span class="mxinfo " id="T3:U579">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,150" id="srcline150">150</a></span><span class="line">            <span class="mxinfo " id="T3:U580"><span class="mxinfo " id="T3:U581"><span class="var type1" id="S9T2U750">A</span>(<span class="mxinfo " id="T3:U583"><span class="var type1" id="S46T4U752">Icand</span>(<span class="var type1" id="S53T3U753">mini</span>)</span>,<span class="mxinfo " id="T3:U586"><span class="var type1" id="S49T4U755">Xcand</span>(<span class="var type1" id="S53T3U756">mini</span>)</span>)</span> = <span class="mxinfo " id="T3:U589">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,151" id="srcline151">151</a></span><span class="line">            <span class="mxinfo " id="T3:U590"><span class="mxinfo " id="T3:U591"><span class="var type1" id="S9T2U761">A</span>(<span class="mxinfo " id="T3:U593"><span class="var type1" id="S50T4U763">Ycand</span>(<span class="var type1" id="S53T3U764">mini</span>)</span>,<span class="mxinfo " id="T3:U596"><span class="var type1" id="S49T4U766">Xcand</span>(<span class="var type1" id="S53T3U767">mini</span>)</span>)</span> = <span class="mxinfo " id="T3:U599">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,152" id="srcline152">152</a></span><span class="line">        <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,153" id="srcline153">153</a></span><span class="line">            <span class="comment">% done if best change is no more an improvement</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,154" id="srcline154">154</a></span><span class="line">            <span class="mxinfo " id="T3:U600"><span class="var type1" id="S43T3U772">finished</span> = <span class="mxinfo " id="T3:U602">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,155" id="srcline155">155</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,156" id="srcline156">156</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,157" id="srcline157">157</a></span><span class="line">        <span class="comment">% consistency check for matrix A</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,158" id="srcline158">158</a></span><span class="line">        <span class="mxinfo " id="T6:U603"><span class="var type1" id="S28T6U776">s</span> = <span class="mxinfo " id="T6:U605">sum(<span class="mxinfo " id="T2:U606"><span class="var type1" id="S9T2U780">A</span>(<span class="mxinfo " id="T5:U608">:</span>,<span class="mxinfo " id="T6:U609"><span class="mxinfo " id="T3:U610">1</span>:<span class="var type1" id="S8T3U784">n</span></span>)</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,159" id="srcline159">159</a></span><span class="line">        <span class="mxinfo " id="T10:U612"><span class="keyword">if</span> <span class="mxinfo " id="T6:U613">find(<span class="mxinfo " id="T9:U614"><span class="mxinfo " id="T6:U615"><span class="var type1" id="S28T6U792">s</span>(<span class="mxinfo " id="T6:U617"><span class="mxinfo " id="T3:U618">1</span>:<span class="var type1" id="S8T3U795">n</span></span>)</span>~=<span class="mxinfo " id="T3:U620">1</span></span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,160" id="srcline160">160</a></span><span class="line">            <span class="mxinfo " id="T11:U621"><span class="autoExtrinsicFcn" id="F384N3:B799">disp</span>(<span class="mxinfo " id="T15:U622"><span class="string">'Inconsistent matrix A during optimization. Columns: '</span></span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,161" id="srcline161">161</a></span><span class="line">            find(<span class="mxinfo " id="T9:U623"><span class="mxinfo " id="T6:U624"><span class="var type1" id="S28T6U806">s</span>(<span class="mxinfo " id="T6:U626"><span class="mxinfo " id="T3:U627">1</span>:<span class="var type1" id="S8T3U809">n</span></span>)</span>~=<span class="mxinfo " id="T3:U629">1</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,162" id="srcline162">162</a></span><span class="line">        <span class="keyword">end</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,163" id="srcline163">163</a></span><span class="line">        <span class="mxinfo " id="T4:U630"><span class="var type1" id="S28T4U813">s</span> = <span class="mxinfo " id="T4:U632">sum(<span class="mxinfo " id="T2:U633"><span class="var type1" id="S9T2U817">A</span>(<span class="mxinfo " id="T6:U635"><span class="mxinfo " id="T3:U636">1</span>:<span class="var type1" id="S7T3U820">m</span></span>,<span class="mxinfo " id="T5:U638">:</span>)</span>,2)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,164" id="srcline164">164</a></span><span class="line">        <span class="mxinfo " id="T10:U639"><span class="keyword">if</span> <span class="mxinfo " id="T4:U640">find(<span class="mxinfo " id="T13:U641"><span class="mxinfo " id="T4:U642"><span class="var type1" id="S28T4U829">s</span>(<span class="mxinfo " id="T6:U644"><span class="mxinfo " id="T3:U645">1</span>:<span class="var type1" id="S7T3U832">m</span></span>)</span>~=<span class="mxinfo " id="T3:U647">1</span></span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,165" id="srcline165">165</a></span><span class="line">            <span class="mxinfo " id="T11:U648"><span class="autoExtrinsicFcn" id="F385N3:B836">disp</span>(<span class="mxinfo " id="T16:U649"><span class="string">'Inconsistent matrix A during optimization. Rows:'</span></span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,166" id="srcline166">166</a></span><span class="line">            find(<span class="mxinfo " id="T13:U650"><span class="mxinfo " id="T4:U651"><span class="var type1" id="S28T4U843">s</span>(<span class="mxinfo " id="T6:U653"><span class="mxinfo " id="T3:U654">1</span>:<span class="var type1" id="S7T3U846">m</span></span>)</span>~=<span class="mxinfo " id="T3:U656">1</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,167" id="srcline167">167</a></span><span class="line">        <span class="keyword">end</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,168" id="srcline168">168</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,169" id="srcline169">169</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,170" id="srcline170">170</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,171" id="srcline171">171</a></span><span class="line">    <span class="comment">% Convert link matrix to linked list representation</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,172" id="srcline172">172</a></span><span class="line">    [<span class="var type1" id="S55T4U851">Ilink</span>,<span class="var type1" id="S56T4U852">Jlink</span>] = find(<span class="mxinfo " id="T2:U659"><span class="var type1" id="S9T2U856">A</span>(<span class="mxinfo " id="T6:U661"><span class="mxinfo " id="T3:U662">1</span>:<span class="var type1" id="S7T3U859">m</span></span>,<span class="mxinfo " id="T5:U664">:</span>)</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,173" id="srcline173">173</a></span><span class="line">    <span class="comment">% if link is to dummy particle, set index to -1</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,174" id="srcline174">174</a></span><span class="line">    <span class="mxinfo " id="T4:U665"><span class="mxinfo " id="T4:U666"><span class="var type1" id="S56T4U864">Jlink</span>((<span class="mxinfo " id="T13:U668"><span class="var type1" id="S56T4U867">Jlink</span>==(<span class="mxinfo " id="T3:U670"><span class="var type1" id="S8T3U870">n</span>+<span class="mxinfo " id="T3:U672">1</span></span>)</span>))</span> = <span class="mxinfo " id="T3:U673">-<span class="mxinfo " id="T3:U674">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,175" id="srcline175">175</a></span><span class="line">    <span class="comment">% set linked list indices</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,176" id="srcline176">176</a></span><span class="line">    <span class="mxinfo " id="T4:U675"><span class="mxinfo " id="T4:U676"><span class="mxinfo " id="T2:U677"><span class="var type1" id="S2T1U878">peaks</span>{<span class="mxinfo " id="T3:U679"><span class="var type1" id="S6T3U880">iframe</span>-<span class="mxinfo " id="T3:U681">1</span></span>}</span>(<span class="var type1" id="S55T4U882">Ilink</span>,<span class="mxinfo " id="T3:U683">6</span>)</span> = <span class="var type1" id="S56T4U884">Jlink</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,177" id="srcline177">177</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,178" id="srcline178">178</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,179" id="srcline179">179</a></span><span class="line"><span class="comment">% terminate all linked lists at the very end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,180" id="srcline180">180</a></span><span class="line"><span class="mxinfo " id="T4:U685"><span class="mxinfo " id="T4:U686"><span class="mxinfo " id="T2:U687"><span class="var type1" id="S2T1U889">peaks</span>{<span class="var type1" id="S4T3U890">nframe</span>}</span>(<span class="mxinfo " id="T5:U690">:</span>,<span class="mxinfo " id="T3:U691">6</span>)</span> = <span class="mxinfo " id="T3:U692">-<span class="mxinfo " id="T3:U693">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,181" id="srcline181">181</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,182" id="srcline182">182</a></span><span class="line"><span class="keyword">return</span>;</span></span>
</pre>
</body>
</html>
